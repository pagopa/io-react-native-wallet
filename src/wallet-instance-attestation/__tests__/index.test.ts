import { decode } from "..";

// Wallet Instance Attestation
const token =
  "eyJhbGciOiJFUzI1NiIsInR5cCI6Im9hdXRoLWNsaWVudC1hdHRlc3RhdGlvbitqd3QiLCJraWQiOiJrem91REZ6N05saEdfY1cwME1YX2U1YmZtR21NUkNINFVPeHp5MTZUcUpZIiwidHJ1c3RfY2hhaW4iOlsiZXlKcmFXUWlPaUpJU0RsS1dUbDRSa0V6WlVKd04wZDJVWE5LUldaMloxbFlla2gyTkdSRlpUaHNibXQ0ZERCMk1HTlJJaXdpZEhsd0lqb2laVzUwYVhSNUxYTjBZWFJsYldWdWRDdHFkM1FpTENKaGJHY2lPaUpGVXpJMU5pSjkuZXlKaGRYUm9iM0pwZEhsZmFHbHVkSE1pT2x0ZExDSnBjM01pT2lKb2RIUndjem92TDNkaGJHeGxkQzF3Y205MmFXUmxjaTVqYjIwaUxDSnFkMnR6SWpwN0ltdGxlWE1pT2x0N0ltdDBlU0k2SWtWRElpd2lZM0oySWpvaVVDMHlOVFlpTENKcmFXUWlPaUpyZW05MVJFWjZOMDVzYUVkZlkxY3dNRTFZWDJVMVltWnRSMjFOVWtOSU5GVlBlSHA1TVRaVWNVcFpJaXdpZUNJNklqTkxXbEppZG1kYVZFUjBOazVuUVdKbk9IcElTblJxVVZNMlJraEVObGRsVDBWRE4xbGlTUzFhTlRRaUxDSjVJam9pTlU1VFNGVmhXV0pWTWpWMFdIRTNiVXB3UTI5WVZVWnRhVTQxWWt0MVpVOWZObEJOYzFFMGNuQlRTU0lzSW1Gc1p5STZJa1ZUTWpVMkluMWRmU3dpYldWMFlXUmhkR0VpT25zaVptVmtaWEpoZEdsdmJsOWxiblJwZEhraU9uc2lhRzl0WlhCaFoyVmZkWEpwSWpvaWFIUjBjSE02THk5cGJ5NXBkR0ZzYVdFdWFYUWlMQ0pzYjJkdlgzVnlhU0k2SW1oMGRIQnpPaTh2YVc4dWFYUmhiR2xoTG1sMEwyRnpjMlYwY3k5cGJXY3ZhVzh0YVhRdGJHOW5ieTFpYkhWbExuTjJaeUlzSW05eVoyRnVhWHBoZEdsdmJsOXVZVzFsSWpvaVVHRm5iMUJoSUZNdWNDNUJMaUlzSW5CdmJHbGplVjkxY21raU9pSm9kSFJ3Y3pvdkwybHZMbWwwWVd4cFlTNXBkQzl3Y21sMllXTjVMWEJ2YkdsamVTSXNJblJ2YzE5MWNta2lPaUpvZEhSd2N6b3ZMMmx2TG1sMFlXeHBZUzVwZEM5d2NtbDJZV041TFhCdmJHbGplU0o5TENKM1lXeHNaWFJmY0hKdmRtbGtaWElpT25zaVlXRnNYM1poYkhWbGMxOXpkWEJ3YjNKMFpXUWlPbHNpYUhSMGNITTZMeTlwYnkxa0xXbDBiaTFsZFdScGR5MWhjR2t0Wm5WdVl5MHdNUzVoZW5WeVpYZGxZbk5wZEdWekxtNWxkQzlNYjBFdlltRnphV01pTENKb2RIUndjem92TDJsdkxXUXRhWFJ1TFdWMVpHbDNMV0Z3YVMxbWRXNWpMVEF4TG1GNmRYSmxkMlZpYzJsMFpYTXVibVYwTDB4dlFTOXRaV1JwZFcwaUxDSm9kSFJ3Y3pvdkwybHZMV1F0YVhSdUxXVjFaR2wzTFdGd2FTMW1kVzVqTFRBeExtRjZkWEpsZDJWaWMybDBaWE11Ym1WMEwweHZRUzlvYVdkb2RDSmRMQ0puY21GdWRGOTBlWEJsYzE5emRYQndiM0owWldRaU9sc2lkWEp1T21sbGRHWTZjR0Z5WVcxek9tOWhkWFJvT21Oc2FXVnVkQzFoYzNObGNuUnBiMjR0ZEhsd1pUcHFkM1F0WTJ4cFpXNTBMV0YwZEdWemRHRjBhVzl1SWwwc0ltcDNhM01pT25zaWEyVjVjeUk2VzNzaWEzUjVJam9pUlVNaUxDSjRJam9pTTB0YVVtSjJaMXBVUkhRMlRtZEJZbWM0ZWtoS2RHcFJVelpHU0VRMlYyVlBSVU0zV1dKSkxWbzFOQ0lzSW5raU9pSTFUbE5JVldGWllsVXlOWFJZY1RkdFNuQkRiMWhWUm0xcFRqVmlTM1ZsVDE4MlVFMXpVVFJ5Y0ZOSklpd2lZM0oySWpvaVVDMHlOVFlpTENKcmFXUWlPaUpyZW05MVJFWjZOMDVzYUVkZlkxY3dNRTFZWDJVMVltWnRSMjFOVWtOSU5GVlBlSHA1TVRaVWNVcFpJbjFkZlN3aWRHOXJaVzVmWlc1a2NHOXBiblFpT2lKb2RIUndjem92TDJsdkxXUXRhWFJ1TFdWMVpHbDNMV0Z3YVMxbWRXNWpMVEF4TG1GNmRYSmxkMlZpYzJsMFpYTXVibVYwTDNSdmEyVnVJaXdpZEc5clpXNWZaVzVrY0c5cGJuUmZZWFYwYUY5dFpYUm9iMlJ6WDNOMWNIQnZjblJsWkNJNld5SndjbWwyWVhSbFgydGxlVjlxZDNRaVhTd2lkRzlyWlc1ZlpXNWtjRzlwYm5SZllYVjBhRjl6YVdkdWFXNW5YMkZzWjE5MllXeDFaWE5mYzNWd2NHOXlkR1ZrSWpwYklrVlRNalUySWwxOUxDSmhkWFJvYjNKcGVtRjBhVzl1WDJWdVpIQnZhVzUwSWpvaWFHRnBjRG92THlJc0luSmxjM0J2Ym5ObFgzUjVjR1Z6WDNOMWNIQnZjblJsWkNJNld5SjJjRjkwYjJ0bGJpSmRMQ0oyY0Y5bWIzSnRZWFJ6WDNOMWNIQnZjblJsWkNJNmV5SmtZeXR6WkMxcWQzUWlPbnNpYzJRdGFuZDBYMkZzWjE5MllXeDFaWE1pT2xzaVJWTXlOVFlpWFgxOUxDSmpiR2xsYm5SZmFXUmZjMk5vWlcxbGMxOXpkWEJ3YjNKMFpXUWlPbHNpY0hKbExYSmxaMmx6ZEhKbFpDSXNJbmcxTURsZmMyRnVYMlJ1Y3lKZGZTd2ljM1ZpSWpvaWFIUjBjSE02THk5M1lXeHNaWFF0Y0hKdmRtbGtaWEl1WTI5dElpd2lhV0YwSWpveE56UTNPRE00TnpjNExDSmxlSEFpT2pFM05EYzVNalV4TnpoOS5iVE1vLV9BREpEZ01QdElpQ2d2MkVBV1JHU3RPemtrUXhfcDhURnVhNGMwRW51ZDZrRHdQNXZrVm5Xd0NEYS0wYm00WWdUZXFwc3dyTU5yTjFLbXZ3USJdfQ.eyJpc3MiOiJodHRwczovL3dhbGxldC1wcm92aWRlci5jb20iLCJpYXQiOjE3NDc5MDg4NTMsImV4cCI6MjA1ODk0ODg1MywiY25mIjp7Imp3ayI6eyJrdHkiOiJFQyIsImNydiI6IlAtMjU2IiwieCI6ImdoSG84QVpSUGhJZG1SOXpPX2FhYjBSN0NzRGFoLVhJNXpodDhHWG83MXciLCJ5IjoiWGZ4X1ZmR3pOZlJWVDVjTmJpOGpLWjNLTWdLenFQR0hXQ1QxeWtsQTBVRSIsImtpZCI6Il8yV0czemdoNFhHcmxUQ0s5UWtQb0dTLXBxQXZtZzVDY0dIX200ZXZlMmUifX0sInN1YiI6Il8yV0czemdoNFhHcmxUQ0s5UWtQb0dTLXBxQXZtZzVDY0dIX200ZXZlMmUiLCJ3YWxsZXRfbmFtZSI6IldhbGxldCIsIndhbGxldF9saW5rIjoiaHR0cHM6Ly93YWxsZXQtcHJvdmlkZXIuY29tL3dhbGxldCJ9.6jzcNTwjkxyFef1278XyAC0U2JTWEWJWcZanwAxGborcmJEBGm_420-29B6fJma6FC7ZJzi8vteCV5Hbll6qYg";

describe("decode", () => {
  it("should return Wallet Instance Attestation", async () => {
    const result = decode(token);

    // check shallow shape
    expect(result).toEqual(expect.any(Object));
    // check header in deep
    expect(result.header).toEqual({
      alg: "ES256",
      kid: "kzouDFz7NlhG_cW00MX_e5bfmGmMRCH4UOxzy16TqJY",
      trust_chain: [
        "eyJraWQiOiJISDlKWTl4RkEzZUJwN0d2UXNKRWZ2Z1lYekh2NGRFZThsbmt4dDB2MGNRIiwidHlwIjoiZW50aXR5LXN0YXRlbWVudCtqd3QiLCJhbGciOiJFUzI1NiJ9.eyJhdXRob3JpdHlfaGludHMiOltdLCJpc3MiOiJodHRwczovL3dhbGxldC1wcm92aWRlci5jb20iLCJqd2tzIjp7ImtleXMiOlt7Imt0eSI6IkVDIiwiY3J2IjoiUC0yNTYiLCJraWQiOiJrem91REZ6N05saEdfY1cwME1YX2U1YmZtR21NUkNINFVPeHp5MTZUcUpZIiwieCI6IjNLWlJidmdaVER0Nk5nQWJnOHpISnRqUVM2RkhENldlT0VDN1liSS1aNTQiLCJ5IjoiNU5TSFVhWWJVMjV0WHE3bUpwQ29YVUZtaU41Ykt1ZU9fNlBNc1E0cnBTSSIsImFsZyI6IkVTMjU2In1dfSwibWV0YWRhdGEiOnsiZmVkZXJhdGlvbl9lbnRpdHkiOnsiaG9tZXBhZ2VfdXJpIjoiaHR0cHM6Ly9pby5pdGFsaWEuaXQiLCJsb2dvX3VyaSI6Imh0dHBzOi8vaW8uaXRhbGlhLml0L2Fzc2V0cy9pbWcvaW8taXQtbG9nby1ibHVlLnN2ZyIsIm9yZ2FuaXphdGlvbl9uYW1lIjoiUGFnb1BhIFMucC5BLiIsInBvbGljeV91cmkiOiJodHRwczovL2lvLml0YWxpYS5pdC9wcml2YWN5LXBvbGljeSIsInRvc191cmkiOiJodHRwczovL2lvLml0YWxpYS5pdC9wcml2YWN5LXBvbGljeSJ9LCJ3YWxsZXRfcHJvdmlkZXIiOnsiYWFsX3ZhbHVlc19zdXBwb3J0ZWQiOlsiaHR0cHM6Ly9pby1kLWl0bi1ldWRpdy1hcGktZnVuYy0wMS5henVyZXdlYnNpdGVzLm5ldC9Mb0EvYmFzaWMiLCJodHRwczovL2lvLWQtaXRuLWV1ZGl3LWFwaS1mdW5jLTAxLmF6dXJld2Vic2l0ZXMubmV0L0xvQS9tZWRpdW0iLCJodHRwczovL2lvLWQtaXRuLWV1ZGl3LWFwaS1mdW5jLTAxLmF6dXJld2Vic2l0ZXMubmV0L0xvQS9oaWdodCJdLCJncmFudF90eXBlc19zdXBwb3J0ZWQiOlsidXJuOmlldGY6cGFyYW1zOm9hdXRoOmNsaWVudC1hc3NlcnRpb24tdHlwZTpqd3QtY2xpZW50LWF0dGVzdGF0aW9uIl0sImp3a3MiOnsia2V5cyI6W3sia3R5IjoiRUMiLCJ4IjoiM0taUmJ2Z1pURHQ2TmdBYmc4ekhKdGpRUzZGSEQ2V2VPRUM3WWJJLVo1NCIsInkiOiI1TlNIVWFZYlUyNXRYcTdtSnBDb1hVRm1pTjViS3VlT182UE1zUTRycFNJIiwiY3J2IjoiUC0yNTYiLCJraWQiOiJrem91REZ6N05saEdfY1cwME1YX2U1YmZtR21NUkNINFVPeHp5MTZUcUpZIn1dfSwidG9rZW5fZW5kcG9pbnQiOiJodHRwczovL2lvLWQtaXRuLWV1ZGl3LWFwaS1mdW5jLTAxLmF6dXJld2Vic2l0ZXMubmV0L3Rva2VuIiwidG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2RzX3N1cHBvcnRlZCI6WyJwcml2YXRlX2tleV9qd3QiXSwidG9rZW5fZW5kcG9pbnRfYXV0aF9zaWduaW5nX2FsZ192YWx1ZXNfc3VwcG9ydGVkIjpbIkVTMjU2Il19LCJhdXRob3JpemF0aW9uX2VuZHBvaW50IjoiaGFpcDovLyIsInJlc3BvbnNlX3R5cGVzX3N1cHBvcnRlZCI6WyJ2cF90b2tlbiJdLCJ2cF9mb3JtYXRzX3N1cHBvcnRlZCI6eyJkYytzZC1qd3QiOnsic2Qtand0X2FsZ192YWx1ZXMiOlsiRVMyNTYiXX19LCJjbGllbnRfaWRfc2NoZW1lc19zdXBwb3J0ZWQiOlsicHJlLXJlZ2lzdHJlZCIsIng1MDlfc2FuX2RucyJdfSwic3ViIjoiaHR0cHM6Ly93YWxsZXQtcHJvdmlkZXIuY29tIiwiaWF0IjoxNzQ3ODM4Nzc4LCJleHAiOjE3NDc5MjUxNzh9.bTMo-_ADJDgMPtIiCgv2EAWRGStOzkkQx_p8TFua4c0Enud6kDwP5vkVnWwCDa-0bm4YgTeqpswrMNrN1KmvwQ",
      ],
      typ: "oauth-client-attestation+jwt",
    });

    console.log(result.payload);
    // check payload in deep
    expect(result.payload).toEqual({
      iss: "https://wallet-provider.com",
      sub: "_2WG3zgh4XGrlTCK9QkPoGS-pqAvmg5CcGH_m4eve2e",
      cnf: {
        jwk: {
          crv: "P-256",
          kty: "EC",
          x: "ghHo8AZRPhIdmR9zO_aab0R7CsDah-XI5zht8GXo71w",
          y: "Xfx_VfGzNfRVT5cNbi8jKZ3KMgKzqPGHWCT1yklA0UE",
          kid: "_2WG3zgh4XGrlTCK9QkPoGS-pqAvmg5CcGH_m4eve2e",
        },
      },
      iat: 1747908853,
      exp: 2058948853,
      wallet_link: "https://wallet-provider.com/wallet",
      wallet_name: "Wallet",
    });
  });
});
